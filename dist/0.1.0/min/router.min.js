!function(a){"function"==typeof window.define&&window.define.amd?window.define(["events"],a):a(window.EventEmitter)}(function(a){function b(){if(!(this instanceof b))return new b;var d=this;this.routes=[],this instanceof g?a&&"function"==typeof a.mixin&&a.mixin(this):g.call(this),addEventListener("popstate",function(){c(d,location.pathname||location.hash)})}function c(a,b){var c,e,f,g=a.currentRoute,h=a.emit||a.trigger;for(f=a.routes.length;f--;)if(c=a.routes[f],e=d(b,c.url),e&&c.handler(e)!==!1)return g&&"function"==typeof g.unload&&g.unload(),a.currentUrl=b,a.currentRoute=c,"function"==typeof h&&h.call(a,"route",{url:b}),"function"==typeof a.onroute&&a.onroute(b),!0;return!1}function d(a,b){var c={};a=e(a),b=e(b);for(var d=0;d<Math.max(a.length,b.length);d++)if(":"===b[d].charAt(0))c[b[d].substring(1)]=a[d];else if(b[d]!==a[d])return!1;return c}function e(a){return a.replace(/(^\/+|\/+$)/g,"").split("/")}function f(a,b){return b.url.match(/\/./g).length-b.url.match(/\/./g).length}var g=a.EventEmitter||a;try{b.prototype=new g,b.prototype.constructor=b}catch(h){console.warn(h.message)}return b.prototype.route=function(a,b){return"function"==typeof b?(this.routes.push({url:a,handler:b}),this.routes.sort(f),this):(history[b===!0?"replaceState":"pushState"](0,0,a),this.currentUrl===a||c(this,a))},b.prototype.get=b.prototype.route,b.Router=b,b});