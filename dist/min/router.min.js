!function(a,b){"function"==typeof define&&define.amd?define(["events"],b):"object"==typeof module&&module.exports?module.exports=b(require("events")):a.router=b(a.events||a.EventEmitter)}(this,function(a){function b(){if(!(this instanceof b))return new b;var d=this;this.routes=[],this instanceof i?a&&"function"==typeof a.mixin&&a.mixin(this):i.call(this),addEventListener("popstate",function(){c(d,e())})}function c(a,b){var c,e,g,h,i,j,k,l,m=b,n=a.currentRoute,o=a.emit||a.trigger,p={};if(h=b.split("?"),h.length>1)for(b=h[0],c=h.slice(1).join("?"),k=c.split("&"),l=0;l<k.length;l++)h=k[l].split("="),p[decodeURIComponent(h[0])]=decodeURIComponent(h.slice(1).join("="));if(a.baseUrl){if(i=f(a.baseUrl),f(b).substring(0,i.length)!==i)return!1;b=b.replace(/^\/+/g,"").substring(i.length)}for(b="/"+b.replace(/^\/+/g,""),l=a.routes.length;l--;){if(g=a.routes[l],(h=d(b,g.url))&&(h.$query=p),e=g.handler,"object"==typeof e)if(a.currentRoute===g&&"function"==typeof e.reload)e=e.reload;else{if("function"!=typeof e.load){console.warn("Handler for "+g.url+" is malformed (not a function or an object with a `load` method)");continue}e=e.load}if(h&&e.call(g.handler,h,a)!==!1)return n&&n!==g&&"function"==typeof n.handler.unload&&n.handler.unload(),a.currentUrl=b,a.currentUrlFull=b+(c?"?"+c:""),a.currentUrlRaw=m,a.currentRoute=g,j={url:b,rawUrl:m,params:h,query:p},"function"==typeof o&&o.call(a,"route",j),"function"==typeof a.onroute&&a.onroute(j),!0}return!1}function d(a,b){var c={};a=g(a),b=g(b);for(var d=0;d<Math.max(a.length,b.length);d++)if(b[d]&&":"===b[d].charAt(0))c[b[d].substring(1)]=decodeURIComponent(a[d]);else if(b[d]!==a[d])return!1;return c}function e(a){return(a||location.pathname.substring(1)+location.search||location.hash.substring(1)||"").replace(/^\/*(#\/)?/g,"/")}function f(a){return a.replace(/(^\/+|\/+$)/g,"")}function g(a){return f(a).split("/")}function h(a,b){return g(b.url).length-g(a.url).length}var i=a.EventEmitter||a;try{b.prototype=new i,b.prototype.constructor=b}catch(j){console.warn(j.message)}return b.prototype.init=function(a){return this.route(e(a),!0,!1)},b.prototype.setBaseUrl=function(a){this.baseUrl=a},b.prototype.baseUrl="/",b.prototype.route=function(a,b,d){var e=typeof b;return"object"==typeof a&&a.url&&(b=a,a=a.url),"function"===e||"object"===e?(this.routes.push({url:a,handler:b}),this.routes.sort(h),this):(d!==!1&&this.baseUrl&&(a=("/"+this.baseUrl+"/"+a).replace(/\/{2,}/g,"/")),"/"!==a.charAt(0)&&(a="/"+a),history[b===!0?"replaceState":"pushState"](0,0,a),this.currentUrlFull===a||c(this,a))},b.prototype.get=b.prototype.route,b.prototype.isUrlActive=function(a){var b=this.currentRoute;return b&&!!d(a,b.url)},b.Router=b,b});