!function(a){"function"==typeof window.define&&window.define.amd?window.define(["events"],a):a(window.EventEmitter)}(function(a){function b(){if(!(this instanceof b))return new b;var d=this;this.routes=[],this instanceof h?a&&"function"==typeof a.mixin&&a.mixin(this):h.call(this),addEventListener("popstate",function(){c(d,location.pathname||location.hash)})}function c(a,b){var c,f,g,h,i,j,k=b,l=a.currentRoute,m=a.emit||a.trigger;if(a.baseUrl){if(g=e(a.baseUrl),e(b).substring(0,g.length)!==g)return!1;b=b.replace(/^\/+/g,"").substring(g.length)}for(b="/"+b.replace(/^\/+/g,""),i=a.routes.length;i--;){if(c=a.routes[i],f=d(b,c.url),j=c.handler,"object"==typeof j)if(a.currentRoute===c&&"function"==typeof j.reload)j=j.reload;else{if("function"!=typeof j.load){console.warn("Handler for "+c.url+" is malformed (not a function or an object with a `load` method)");continue}j=j.load}if(f&&j.call(c.handler,f,a)!==!1)return l&&l!==c&&"function"==typeof l.handler.unload&&l.handler.unload(),a.currentUrl=b,a.currentUrlRaw=k,a.currentRoute=c,h={url:b,rawUrl:k},"function"==typeof m&&m.call(a,"route",h),"function"==typeof a.onroute&&a.onroute(h),!0}return!1}function d(a,b){var c={};a=f(a),b=f(b);for(var d=0;d<Math.max(a.length,b.length);d++)if(":"===b[d].charAt(0))c[b[d].substring(1)]=a[d];else if(b[d]!==a[d])return!1;return c}function e(a){return a.replace(/(^\/+|\/+$)/g,"")}function f(a){return e(a).split("/")}function g(a,b){return f(b.url).length-f(a.url).length}var h=a.EventEmitter||a;try{b.prototype=new h,b.prototype.constructor=b}catch(i){console.warn(i.message)}return b.prototype.setBaseUrl=function(a){this.baseUrl=a},b.prototype.baseUrl="/",b.prototype.route=function(a,b,d){var e=typeof b;return"object"==typeof a&&a.url&&(b=a,a=a.url),"function"===e||"object"===e?(this.routes.push({url:a,handler:b}),this.routes.sort(g),this):(d!==!1&&this.baseUrl&&(a=this.baseUrl.replace(/\/+$/g,"")+"/"+a.replace(/^\/+/g,"")),history[b===!0?"replaceState":"pushState"](0,0,a),this.currentUrl===a||c(this,a))},b.prototype.get=b.prototype.route,b.prototype.isUrlActive=function(a){var b=this.currentRoute;return b&&!!d(a,b.url)},b.Router=b,b});