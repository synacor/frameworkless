!function(a){"function"==typeof window.define&&window.define.amd?window.define(["events"],a):a(window.EventEmitter)}(function(a){function b(){if(!(this instanceof b))return new b;var d=this;this.routes=[],this instanceof h?a&&"function"==typeof a.mixin&&a.mixin(this):h.call(this),addEventListener("popstate",function(){c(d,location.pathname?location.pathname+location.search||"":location.hash)})}function c(a,b){var c,f,g,h,i,j,k,l,m=b,n=a.currentRoute,o=a.emit||a.trigger,p={};if(h=b.split("?"),h.length>1)for(b=h[0],c=h.slice(1).join("?"),k=c.split("&"),l=0;l<k.length;l++)h=k[l].split("="),p[decodeURIComponent(h[0])]=decodeURIComponent(h.slice(1).join("="));if(a.baseUrl){if(i=e(a.baseUrl),e(b).substring(0,i.length)!==i)return!1;b=b.replace(/^\/+/g,"").substring(i.length)}for(b="/"+b.replace(/^\/+/g,""),l=a.routes.length;l--;){if(g=a.routes[l],(h=d(b,g.url))&&(h.$query=p),f=g.handler,"object"==typeof f)if(a.currentRoute===g&&"function"==typeof f.reload)f=f.reload;else{if("function"!=typeof f.load){console.warn("Handler for "+g.url+" is malformed (not a function or an object with a `load` method)");continue}f=f.load}if(h&&f.call(g.handler,h,a)!==!1)return n&&n!==g&&"function"==typeof n.handler.unload&&n.handler.unload(),a.currentUrl=b,a.currentUrlFull=b+(c?"?"+c:""),a.currentUrlRaw=m,a.currentRoute=g,j={url:b,rawUrl:m,params:h,query:p},"function"==typeof o&&o.call(a,"route",j),"function"==typeof a.onroute&&a.onroute(j),!0}return!1}function d(a,b){var c={};a=f(a),b=f(b);for(var d=0;d<Math.max(a.length,b.length);d++)if(":"===b[d].charAt(0))c[b[d].substring(1)]=a[d];else if(b[d]!==a[d])return!1;return c}function e(a){return a.replace(/(^\/+|\/+$)/g,"")}function f(a){return e(a).split("/")}function g(a,b){return f(b.url).length-f(a.url).length}var h=a.EventEmitter||a;try{b.prototype=new h,b.prototype.constructor=b}catch(i){console.warn(i.message)}return b.prototype.init=function(a){return this.route(a||location.pathname&&location.pathname+location.search||location.hash||"/",!0,!1)},b.prototype.setBaseUrl=function(a){this.baseUrl=a},b.prototype.baseUrl="/",b.prototype.route=function(a,b,d){var e=typeof b;return"object"==typeof a&&a.url&&(b=a,a=a.url),"function"===e||"object"===e?(this.routes.push({url:a,handler:b}),this.routes.sort(g),this):(d!==!1&&this.baseUrl&&(a=this.baseUrl.replace(/(?:^\/+|\/+(\?|$))/g,"$1")+"/"+a.replace(/^\/+/g,"")),history[b===!0?"replaceState":"pushState"](0,0,a),this.currentUrlFull===a||c(this,a))},b.prototype.get=b.prototype.route,b.prototype.isUrlActive=function(a){var b=this.currentRoute;return b&&!!d(a,b.url)},b.Router=b,b});